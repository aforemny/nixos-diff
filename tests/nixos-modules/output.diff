[31m-system.build.toplevel = Â«derivation /nix/store/kafy59snhq30vyxr3j1hjzn45hpijvha-nixos-system-nixos-25.05pre-git.drvÂ»;[0m
[32m+system.build.toplevel = Â«derivation /nix/store/05kxd15g4ksvh2dkwcdg9dns7mz3d63n-nixos-system-machine-25.05pre-git.drvÂ»;[0m
[31m-system.build.etc = Â«derivation /nix/store/yqzvmp0sjjl8clhrcdp40fl4bfs31w1y-etc.drvÂ»;[0m
[32m+system.build.etc = Â«derivation /nix/store/bzgvkhvyrn80f2hv03ikiyvh1j8w1xm9-etc.drvÂ»;[0m
[31m-system.build.etcActivationCommands = ''[0m
[31m  # Set up the statically computed bits of /etc.[0m
[31m  echo "setting up /etc..."[0m
[31m  /nix/store/vykd7i3p2ynk1g9f4pbp234pxy2sd5w3-perl-5.40.0-env/bin/perl /nix/store/rg5rf512szdxmnj9qal3wfdnpfsx38qi-setup-etc.pl /nix/store/r0qwrz3av7yxlzrlnbw4r5gk67cf7xrz-etc/etc[0m
[31m  [31m'';[0m
[32m+system.build.etcActivationCommands = ''[0m
[32m  # Set up the statically computed bits of /etc.[0m
[32m  echo "setting up /etc..."[0m
[32m  /nix/store/vykd7i3p2ynk1g9f4pbp234pxy2sd5w3-perl-5.40.0-env/bin/perl /nix/store/rg5rf512szdxmnj9qal3wfdnpfsx38qi-setup-etc.pl /nix/store/a7ik90s4k29y4l6y95p7a2a0n4vqm3qv-etc/etc[0m
[32m  [32m'';[0m
[31m-system.activationScripts.etc.text = ''[0m
[31m  # Set up the statically computed bits of /etc.[0m
[31m  echo "setting up /etc..."[0m
[31m  /nix/store/vykd7i3p2ynk1g9f4pbp234pxy2sd5w3-perl-5.40.0-env/bin/perl /nix/store/rg5rf512szdxmnj9qal3wfdnpfsx38qi-setup-etc.pl /nix/store/r0qwrz3av7yxlzrlnbw4r5gk67cf7xrz-etc/etc[0m
[31m  [31m'';[0m
[32m+system.activationScripts.etc.text = ''[0m
[32m  # Set up the statically computed bits of /etc.[0m
[32m  echo "setting up /etc..."[0m
[32m  /nix/store/vykd7i3p2ynk1g9f4pbp234pxy2sd5w3-perl-5.40.0-env/bin/perl /nix/store/rg5rf512szdxmnj9qal3wfdnpfsx38qi-setup-etc.pl /nix/store/a7ik90s4k29y4l6y95p7a2a0n4vqm3qv-etc/etc[0m
[32m  [32m'';[0m
[31m-system.activationScripts.script = ''[0m
[31m  #!/nix/store/11ciq72n4fdv8rw6wgjgasfv4mjs1jrw-bash-5.2p37/bin/bash[0m
[31m  [0m
[31m  source /nix/store/mhxn5kwnri3z9hdzi3x0980id65p0icn-lib.sh[0m
[31m  [0m
[31m  systemConfig='@out@'[0m
[31m  [0m
[31m  export PATH=/empty[0m
[31m  for i in /nix/store/fr9yr63a1267cr0r86w18c77mh3xavcc-coreutils-9.6 /nix/store/yz6nq9v29l3g990w8zlqsnzlzbicd3b3-gnugrep-3.11 /nix/store/lk2sg2yq5jqs9dlx5ini46kvjwk7ffsf-findutils-4.10.0 /nix/store/fcdkag93vlvv7b7833yd1fkx0b1nnp18-getent-glibc-2.40-66 /nix/store/4q7kqnnr018yr54dsqdc5gvfqkwm6xa5-glibc-2.40-66-bin /nix/store/yvai185j6zsgck2y4yq0dddjwlyphhy5-shadow-4.17.2 /nix/store/b6lq773adiv84fvjydmq5f2r3758963d-net-tools-2.10 /nix/store/8qp4dnhf02xg43c3yrqc63ivhxwhk950-util-linux-2.40.4-bin; do[0m
[31m      PATH=$PATH:$i/bin:$i/sbin[0m
[31m  done[0m
[31m  [0m
[31m  _status=0[0m
[31m  trap "_status=1 _localstatus=\$?" ERR[0m
[31m  [0m
[31m  # Ensure a consistent umask.[0m
[31m  umask 0022[0m
[31m  [0m
[31m  #### Activation script snippet stdio:[0m
[31m  _localstatus=0[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "stdio" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet binsh:[0m
[31m  _localstatus=0[0m
[31m  # Create the required /bin/sh symlink; otherwise lots of things[0m
[31m  # (notably the system() function) won't work.[0m
[31m  mkdir -p /bin[0m
[31m  chmod 0755 /bin[0m
[31m  ln -sfn "/nix/store/4k90qpzh1a4sldhnf7cxwkm9c0agq4fp-bash-interactive-5.2p37/bin/sh" /bin/.sh.tmp[0m
[31m  mv /bin/.sh.tmp /bin/sh # atomically replace /bin/sh[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "binsh" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet users:[0m
[31m  _localstatus=0[0m
[31m  install -m 0700 -d /root[0m
[31m  install -m 0755 -d /home[0m
[31m  [0m
[31m  /nix/store/m6b7npfq8qb50hzs4ignni77a7wbxbcd-perl-5.40.0-env/bin/perl \[0m
[31m  -w /nix/store/sll7fxa3fgbrjacmn3hbqi2avjlqij2k-update-users-groups.pl /nix/store/644mi6j6s2rkrzm4y6s42w8jc430d735-users-groups.json[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "users" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet groups:[0m
[31m  _localstatus=0[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "groups" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet specialfs:[0m
[31m  _localstatus=0[0m
[31m  specialMount() {[0m
[31m    local device="$1"[0m
[31m    local mountPoint="$2"[0m
[31m    local options="$3"[0m
[31m    local fsType="$4"[0m
[31m  [0m
[31m    if mountpoint -q "$mountPoint"; then[0m
[31m      local options="remount,$options"[0m
[31m    else[0m
[31m      mkdir -p "$mountPoint"[0m
[31m      chmod 0755 "$mountPoint"[0m
[31m    fi[0m
[31m    mount -t "$fsType" -o "$options" "$device" "$mountPoint"[0m
[31m  }[0m
[31m  source /nix/store/ksi2zyyqpw547jv22h90rmgxyk8qh920-mounts.sh[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "specialfs" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet etc:[0m
[31m  _localstatus=0[0m
[31m  # Set up the statically computed bits of /etc.[0m
[31m  echo "setting up /etc..."[0m
[31m  /nix/store/vykd7i3p2ynk1g9f4pbp234pxy2sd5w3-perl-5.40.0-env/bin/perl /nix/store/rg5rf512szdxmnj9qal3wfdnpfsx38qi-setup-etc.pl /nix/store/r0qwrz3av7yxlzrlnbw4r5gk67cf7xrz-etc/etc[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "etc" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet hashes:[0m
[31m  _localstatus=0[0m
[31m  users=()[0m
[31m  while IFS=: read -r user hash _; do[0m
[31m    if [[ "$hash" = "$"* && ! "$hash" =~ ^\$(y|gy|7|2b|2y|2a|6)\$ ]]; then[0m
[31m      users+=("$user")[0m
[31m    fi[0m
[31m  done </etc/shadow[0m
[31m  [0m
[31m  if (( "${#users[@]}" )); then[0m
[31m    echo "[0m
[31m  WARNING: The following user accounts rely on password hashing algorithms[0m
[31m  that have been removed. They need to be renewed as soon as possible, as[0m
[31m  they do prevent their users from logging in."[0m
[31m    printf ' - %s\n' "${users[@]}"[0m
[31m  fi[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "hashes" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet modprobe:[0m
[31m  _localstatus=0[0m
[31m  # Allow the kernel to find our wrapped modprobe (which searches[0m
[31m  # in the right location in the Nix store for kernel modules).[0m
[31m  # We need this when the kernel (or some module) auto-loads a[0m
[31m  # module.[0m
[31m  echo /nix/store/d60481jmwlgh80kxrn4bmfmkpxmv2cip-kmod-31/bin/modprobe > /proc/sys/kernel/modprobe[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "modprobe" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet udevd:[0m
[31m  _localstatus=0[0m
[31m  # The deprecated hotplug uevent helper is not used anymore[0m
[31m  if [ -e /proc/sys/kernel/hotplug ]; then[0m
[31m    echo "" > /proc/sys/kernel/hotplug[0m
[31m  fi[0m
[31m  [0m
[31m  # Allow the kernel to find our firmware.[0m
[31m  if [ -e /sys/module/firmware_class/parameters/path ]; then[0m
[31m    echo -n "/nix/store/d97p4z8x60vfv57krbxsrb0a98hlz17q-firmware/lib/firmware" > /sys/module/firmware_class/parameters/path[0m
[31m  fi[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "udevd" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet usrbinenv:[0m
[31m  _localstatus=0[0m
[31m  mkdir -p /usr/bin[0m
[31m  chmod 0755 /usr/bin[0m
[31m  ln -sfn /nix/store/fr9yr63a1267cr0r86w18c77mh3xavcc-coreutils-9.6/bin/env /usr/bin/.env.tmp[0m
[31m  mv /usr/bin/.env.tmp /usr/bin/env # atomically replace /usr/bin/env[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "usrbinenv" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet var:[0m
[31m  _localstatus=0[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "var" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  [0m
[31m  # Make this configuration the current configuration.[0m
[31m  # The readlink is there to ensure that when $systemConfig = /system[0m
[31m  # (which is a symlink to the store), /run/current-system is still[0m
[31m  # used as a garbage collection root.[0m
[31m  ln -sfn "$(readlink -f "$systemConfig")" /run/current-system[0m
[31m  [0m
[31m  exit $_status[0m
[31m  [31m'';[0m
[32m+system.activationScripts.script = ''[0m
[32m  #!/nix/store/11ciq72n4fdv8rw6wgjgasfv4mjs1jrw-bash-5.2p37/bin/bash[0m
[32m  [0m
[32m  source /nix/store/mhxn5kwnri3z9hdzi3x0980id65p0icn-lib.sh[0m
[32m  [0m
[32m  systemConfig='@out@'[0m
[32m  [0m
[32m  export PATH=/empty[0m
[32m  for i in /nix/store/fr9yr63a1267cr0r86w18c77mh3xavcc-coreutils-9.6 /nix/store/yz6nq9v29l3g990w8zlqsnzlzbicd3b3-gnugrep-3.11 /nix/store/lk2sg2yq5jqs9dlx5ini46kvjwk7ffsf-findutils-4.10.0 /nix/store/fcdkag93vlvv7b7833yd1fkx0b1nnp18-getent-glibc-2.40-66 /nix/store/4q7kqnnr018yr54dsqdc5gvfqkwm6xa5-glibc-2.40-66-bin /nix/store/yvai185j6zsgck2y4yq0dddjwlyphhy5-shadow-4.17.2 /nix/store/b6lq773adiv84fvjydmq5f2r3758963d-net-tools-2.10 /nix/store/8qp4dnhf02xg43c3yrqc63ivhxwhk950-util-linux-2.40.4-bin; do[0m
[32m      PATH=$PATH:$i/bin:$i/sbin[0m
[32m  done[0m
[32m  [0m
[32m  _status=0[0m
[32m  trap "_status=1 _localstatus=\$?" ERR[0m
[32m  [0m
[32m  # Ensure a consistent umask.[0m
[32m  umask 0022[0m
[32m  [0m
[32m  #### Activation script snippet stdio:[0m
[32m  _localstatus=0[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "stdio" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet binsh:[0m
[32m  _localstatus=0[0m
[32m  # Create the required /bin/sh symlink; otherwise lots of things[0m
[32m  # (notably the system() function) won't work.[0m
[32m  mkdir -p /bin[0m
[32m  chmod 0755 /bin[0m
[32m  ln -sfn "/nix/store/4k90qpzh1a4sldhnf7cxwkm9c0agq4fp-bash-interactive-5.2p37/bin/sh" /bin/.sh.tmp[0m
[32m  mv /bin/.sh.tmp /bin/sh # atomically replace /bin/sh[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "binsh" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet users:[0m
[32m  _localstatus=0[0m
[32m  install -m 0700 -d /root[0m
[32m  install -m 0755 -d /home[0m
[32m  [0m
[32m  /nix/store/m6b7npfq8qb50hzs4ignni77a7wbxbcd-perl-5.40.0-env/bin/perl \[0m
[32m  -w /nix/store/sll7fxa3fgbrjacmn3hbqi2avjlqij2k-update-users-groups.pl /nix/store/644mi6j6s2rkrzm4y6s42w8jc430d735-users-groups.json[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "users" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet groups:[0m
[32m  _localstatus=0[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "groups" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet specialfs:[0m
[32m  _localstatus=0[0m
[32m  specialMount() {[0m
[32m    local device="$1"[0m
[32m    local mountPoint="$2"[0m
[32m    local options="$3"[0m
[32m    local fsType="$4"[0m
[32m  [0m
[32m    if mountpoint -q "$mountPoint"; then[0m
[32m      local options="remount,$options"[0m
[32m    else[0m
[32m      mkdir -p "$mountPoint"[0m
[32m      chmod 0755 "$mountPoint"[0m
[32m    fi[0m
[32m    mount -t "$fsType" -o "$options" "$device" "$mountPoint"[0m
[32m  }[0m
[32m  source /nix/store/ksi2zyyqpw547jv22h90rmgxyk8qh920-mounts.sh[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "specialfs" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet etc:[0m
[32m  _localstatus=0[0m
[32m  # Set up the statically computed bits of /etc.[0m
[32m  echo "setting up /etc..."[0m
[32m  /nix/store/vykd7i3p2ynk1g9f4pbp234pxy2sd5w3-perl-5.40.0-env/bin/perl /nix/store/rg5rf512szdxmnj9qal3wfdnpfsx38qi-setup-etc.pl /nix/store/a7ik90s4k29y4l6y95p7a2a0n4vqm3qv-etc/etc[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "etc" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet hashes:[0m
[32m  _localstatus=0[0m
[32m  users=()[0m
[32m  while IFS=: read -r user hash _; do[0m
[32m    if [[ "$hash" = "$"* && ! "$hash" =~ ^\$(y|gy|7|2b|2y|2a|6)\$ ]]; then[0m
[32m      users+=("$user")[0m
[32m    fi[0m
[32m  done </etc/shadow[0m
[32m  [0m
[32m  if (( "${#users[@]}" )); then[0m
[32m    echo "[0m
[32m  WARNING: The following user accounts rely on password hashing algorithms[0m
[32m  that have been removed. They need to be renewed as soon as possible, as[0m
[32m  they do prevent their users from logging in."[0m
[32m    printf ' - %s\n' "${users[@]}"[0m
[32m  fi[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "hashes" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet modprobe:[0m
[32m  _localstatus=0[0m
[32m  # Allow the kernel to find our wrapped modprobe (which searches[0m
[32m  # in the right location in the Nix store for kernel modules).[0m
[32m  # We need this when the kernel (or some module) auto-loads a[0m
[32m  # module.[0m
[32m  echo /nix/store/d60481jmwlgh80kxrn4bmfmkpxmv2cip-kmod-31/bin/modprobe > /proc/sys/kernel/modprobe[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "modprobe" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet udevd:[0m
[32m  _localstatus=0[0m
[32m  # The deprecated hotplug uevent helper is not used anymore[0m
[32m  if [ -e /proc/sys/kernel/hotplug ]; then[0m
[32m    echo "" > /proc/sys/kernel/hotplug[0m
[32m  fi[0m
[32m  [0m
[32m  # Allow the kernel to find our firmware.[0m
[32m  if [ -e /sys/module/firmware_class/parameters/path ]; then[0m
[32m    echo -n "/nix/store/d97p4z8x60vfv57krbxsrb0a98hlz17q-firmware/lib/firmware" > /sys/module/firmware_class/parameters/path[0m
[32m  fi[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "udevd" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet usrbinenv:[0m
[32m  _localstatus=0[0m
[32m  mkdir -p /usr/bin[0m
[32m  chmod 0755 /usr/bin[0m
[32m  ln -sfn /nix/store/fr9yr63a1267cr0r86w18c77mh3xavcc-coreutils-9.6/bin/env /usr/bin/.env.tmp[0m
[32m  mv /usr/bin/.env.tmp /usr/bin/env # atomically replace /usr/bin/env[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "usrbinenv" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet var:[0m
[32m  _localstatus=0[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "var" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  [0m
[32m  # Make this configuration the current configuration.[0m
[32m  # The readlink is there to ensure that when $systemConfig = /system[0m
[32m  # (which is a symlink to the store), /run/current-system is still[0m
[32m  # used as a garbage collection root.[0m
[32m  ln -sfn "$(readlink -f "$systemConfig")" /run/current-system[0m
[32m  [0m
[32m  exit $_status[0m
[32m  [32m'';[0m
[31m-system.systemBuilderArgs.activationScript = ''[0m
[31m  #!/nix/store/11ciq72n4fdv8rw6wgjgasfv4mjs1jrw-bash-5.2p37/bin/bash[0m
[31m  [0m
[31m  source /nix/store/mhxn5kwnri3z9hdzi3x0980id65p0icn-lib.sh[0m
[31m  [0m
[31m  systemConfig='@out@'[0m
[31m  [0m
[31m  export PATH=/empty[0m
[31m  for i in /nix/store/fr9yr63a1267cr0r86w18c77mh3xavcc-coreutils-9.6 /nix/store/yz6nq9v29l3g990w8zlqsnzlzbicd3b3-gnugrep-3.11 /nix/store/lk2sg2yq5jqs9dlx5ini46kvjwk7ffsf-findutils-4.10.0 /nix/store/fcdkag93vlvv7b7833yd1fkx0b1nnp18-getent-glibc-2.40-66 /nix/store/4q7kqnnr018yr54dsqdc5gvfqkwm6xa5-glibc-2.40-66-bin /nix/store/yvai185j6zsgck2y4yq0dddjwlyphhy5-shadow-4.17.2 /nix/store/b6lq773adiv84fvjydmq5f2r3758963d-net-tools-2.10 /nix/store/8qp4dnhf02xg43c3yrqc63ivhxwhk950-util-linux-2.40.4-bin; do[0m
[31m      PATH=$PATH:$i/bin:$i/sbin[0m
[31m  done[0m
[31m  [0m
[31m  _status=0[0m
[31m  trap "_status=1 _localstatus=\$?" ERR[0m
[31m  [0m
[31m  # Ensure a consistent umask.[0m
[31m  umask 0022[0m
[31m  [0m
[31m  #### Activation script snippet stdio:[0m
[31m  _localstatus=0[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "stdio" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet binsh:[0m
[31m  _localstatus=0[0m
[31m  # Create the required /bin/sh symlink; otherwise lots of things[0m
[31m  # (notably the system() function) won't work.[0m
[31m  mkdir -p /bin[0m
[31m  chmod 0755 /bin[0m
[31m  ln -sfn "/nix/store/4k90qpzh1a4sldhnf7cxwkm9c0agq4fp-bash-interactive-5.2p37/bin/sh" /bin/.sh.tmp[0m
[31m  mv /bin/.sh.tmp /bin/sh # atomically replace /bin/sh[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "binsh" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet users:[0m
[31m  _localstatus=0[0m
[31m  install -m 0700 -d /root[0m
[31m  install -m 0755 -d /home[0m
[31m  [0m
[31m  /nix/store/m6b7npfq8qb50hzs4ignni77a7wbxbcd-perl-5.40.0-env/bin/perl \[0m
[31m  -w /nix/store/sll7fxa3fgbrjacmn3hbqi2avjlqij2k-update-users-groups.pl /nix/store/644mi6j6s2rkrzm4y6s42w8jc430d735-users-groups.json[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "users" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet groups:[0m
[31m  _localstatus=0[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "groups" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet specialfs:[0m
[31m  _localstatus=0[0m
[31m  specialMount() {[0m
[31m    local device="$1"[0m
[31m    local mountPoint="$2"[0m
[31m    local options="$3"[0m
[31m    local fsType="$4"[0m
[31m  [0m
[31m    if mountpoint -q "$mountPoint"; then[0m
[31m      local options="remount,$options"[0m
[31m    else[0m
[31m      mkdir -p "$mountPoint"[0m
[31m      chmod 0755 "$mountPoint"[0m
[31m    fi[0m
[31m    mount -t "$fsType" -o "$options" "$device" "$mountPoint"[0m
[31m  }[0m
[31m  source /nix/store/ksi2zyyqpw547jv22h90rmgxyk8qh920-mounts.sh[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "specialfs" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet etc:[0m
[31m  _localstatus=0[0m
[31m  # Set up the statically computed bits of /etc.[0m
[31m  echo "setting up /etc..."[0m
[31m  /nix/store/vykd7i3p2ynk1g9f4pbp234pxy2sd5w3-perl-5.40.0-env/bin/perl /nix/store/rg5rf512szdxmnj9qal3wfdnpfsx38qi-setup-etc.pl /nix/store/r0qwrz3av7yxlzrlnbw4r5gk67cf7xrz-etc/etc[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "etc" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet hashes:[0m
[31m  _localstatus=0[0m
[31m  users=()[0m
[31m  while IFS=: read -r user hash _; do[0m
[31m    if [[ "$hash" = "$"* && ! "$hash" =~ ^\$(y|gy|7|2b|2y|2a|6)\$ ]]; then[0m
[31m      users+=("$user")[0m
[31m    fi[0m
[31m  done </etc/shadow[0m
[31m  [0m
[31m  if (( "${#users[@]}" )); then[0m
[31m    echo "[0m
[31m  WARNING: The following user accounts rely on password hashing algorithms[0m
[31m  that have been removed. They need to be renewed as soon as possible, as[0m
[31m  they do prevent their users from logging in."[0m
[31m    printf ' - %s\n' "${users[@]}"[0m
[31m  fi[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "hashes" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet modprobe:[0m
[31m  _localstatus=0[0m
[31m  # Allow the kernel to find our wrapped modprobe (which searches[0m
[31m  # in the right location in the Nix store for kernel modules).[0m
[31m  # We need this when the kernel (or some module) auto-loads a[0m
[31m  # module.[0m
[31m  echo /nix/store/d60481jmwlgh80kxrn4bmfmkpxmv2cip-kmod-31/bin/modprobe > /proc/sys/kernel/modprobe[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "modprobe" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet udevd:[0m
[31m  _localstatus=0[0m
[31m  # The deprecated hotplug uevent helper is not used anymore[0m
[31m  if [ -e /proc/sys/kernel/hotplug ]; then[0m
[31m    echo "" > /proc/sys/kernel/hotplug[0m
[31m  fi[0m
[31m  [0m
[31m  # Allow the kernel to find our firmware.[0m
[31m  if [ -e /sys/module/firmware_class/parameters/path ]; then[0m
[31m    echo -n "/nix/store/d97p4z8x60vfv57krbxsrb0a98hlz17q-firmware/lib/firmware" > /sys/module/firmware_class/parameters/path[0m
[31m  fi[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "udevd" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet usrbinenv:[0m
[31m  _localstatus=0[0m
[31m  mkdir -p /usr/bin[0m
[31m  chmod 0755 /usr/bin[0m
[31m  ln -sfn /nix/store/fr9yr63a1267cr0r86w18c77mh3xavcc-coreutils-9.6/bin/env /usr/bin/.env.tmp[0m
[31m  mv /usr/bin/.env.tmp /usr/bin/env # atomically replace /usr/bin/env[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "usrbinenv" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  #### Activation script snippet var:[0m
[31m  _localstatus=0[0m
[31m  [0m
[31m  [0m
[31m  if (( _localstatus > 0 )); then[0m
[31m    printf "Activation script snippet '%s' failed (%s)\n" "var" "$_localstatus"[0m
[31m  fi[0m
[31m  [0m
[31m  [0m
[31m  # Make this configuration the current configuration.[0m
[31m  # The readlink is there to ensure that when $systemConfig = /system[0m
[31m  # (which is a symlink to the store), /run/current-system is still[0m
[31m  # used as a garbage collection root.[0m
[31m  ln -sfn "$(readlink -f "$systemConfig")" /run/current-system[0m
[31m  [0m
[31m  exit $_status[0m
[31m  [31m'';[0m
[32m+system.systemBuilderArgs.activationScript = ''[0m
[32m  #!/nix/store/11ciq72n4fdv8rw6wgjgasfv4mjs1jrw-bash-5.2p37/bin/bash[0m
[32m  [0m
[32m  source /nix/store/mhxn5kwnri3z9hdzi3x0980id65p0icn-lib.sh[0m
[32m  [0m
[32m  systemConfig='@out@'[0m
[32m  [0m
[32m  export PATH=/empty[0m
[32m  for i in /nix/store/fr9yr63a1267cr0r86w18c77mh3xavcc-coreutils-9.6 /nix/store/yz6nq9v29l3g990w8zlqsnzlzbicd3b3-gnugrep-3.11 /nix/store/lk2sg2yq5jqs9dlx5ini46kvjwk7ffsf-findutils-4.10.0 /nix/store/fcdkag93vlvv7b7833yd1fkx0b1nnp18-getent-glibc-2.40-66 /nix/store/4q7kqnnr018yr54dsqdc5gvfqkwm6xa5-glibc-2.40-66-bin /nix/store/yvai185j6zsgck2y4yq0dddjwlyphhy5-shadow-4.17.2 /nix/store/b6lq773adiv84fvjydmq5f2r3758963d-net-tools-2.10 /nix/store/8qp4dnhf02xg43c3yrqc63ivhxwhk950-util-linux-2.40.4-bin; do[0m
[32m      PATH=$PATH:$i/bin:$i/sbin[0m
[32m  done[0m
[32m  [0m
[32m  _status=0[0m
[32m  trap "_status=1 _localstatus=\$?" ERR[0m
[32m  [0m
[32m  # Ensure a consistent umask.[0m
[32m  umask 0022[0m
[32m  [0m
[32m  #### Activation script snippet stdio:[0m
[32m  _localstatus=0[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "stdio" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet binsh:[0m
[32m  _localstatus=0[0m
[32m  # Create the required /bin/sh symlink; otherwise lots of things[0m
[32m  # (notably the system() function) won't work.[0m
[32m  mkdir -p /bin[0m
[32m  chmod 0755 /bin[0m
[32m  ln -sfn "/nix/store/4k90qpzh1a4sldhnf7cxwkm9c0agq4fp-bash-interactive-5.2p37/bin/sh" /bin/.sh.tmp[0m
[32m  mv /bin/.sh.tmp /bin/sh # atomically replace /bin/sh[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "binsh" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet users:[0m
[32m  _localstatus=0[0m
[32m  install -m 0700 -d /root[0m
[32m  install -m 0755 -d /home[0m
[32m  [0m
[32m  /nix/store/m6b7npfq8qb50hzs4ignni77a7wbxbcd-perl-5.40.0-env/bin/perl \[0m
[32m  -w /nix/store/sll7fxa3fgbrjacmn3hbqi2avjlqij2k-update-users-groups.pl /nix/store/644mi6j6s2rkrzm4y6s42w8jc430d735-users-groups.json[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "users" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet groups:[0m
[32m  _localstatus=0[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "groups" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet specialfs:[0m
[32m  _localstatus=0[0m
[32m  specialMount() {[0m
[32m    local device="$1"[0m
[32m    local mountPoint="$2"[0m
[32m    local options="$3"[0m
[32m    local fsType="$4"[0m
[32m  [0m
[32m    if mountpoint -q "$mountPoint"; then[0m
[32m      local options="remount,$options"[0m
[32m    else[0m
[32m      mkdir -p "$mountPoint"[0m
[32m      chmod 0755 "$mountPoint"[0m
[32m    fi[0m
[32m    mount -t "$fsType" -o "$options" "$device" "$mountPoint"[0m
[32m  }[0m
[32m  source /nix/store/ksi2zyyqpw547jv22h90rmgxyk8qh920-mounts.sh[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "specialfs" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet etc:[0m
[32m  _localstatus=0[0m
[32m  # Set up the statically computed bits of /etc.[0m
[32m  echo "setting up /etc..."[0m
[32m  /nix/store/vykd7i3p2ynk1g9f4pbp234pxy2sd5w3-perl-5.40.0-env/bin/perl /nix/store/rg5rf512szdxmnj9qal3wfdnpfsx38qi-setup-etc.pl /nix/store/a7ik90s4k29y4l6y95p7a2a0n4vqm3qv-etc/etc[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "etc" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet hashes:[0m
[32m  _localstatus=0[0m
[32m  users=()[0m
[32m  while IFS=: read -r user hash _; do[0m
[32m    if [[ "$hash" = "$"* && ! "$hash" =~ ^\$(y|gy|7|2b|2y|2a|6)\$ ]]; then[0m
[32m      users+=("$user")[0m
[32m    fi[0m
[32m  done </etc/shadow[0m
[32m  [0m
[32m  if (( "${#users[@]}" )); then[0m
[32m    echo "[0m
[32m  WARNING: The following user accounts rely on password hashing algorithms[0m
[32m  that have been removed. They need to be renewed as soon as possible, as[0m
[32m  they do prevent their users from logging in."[0m
[32m    printf ' - %s\n' "${users[@]}"[0m
[32m  fi[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "hashes" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet modprobe:[0m
[32m  _localstatus=0[0m
[32m  # Allow the kernel to find our wrapped modprobe (which searches[0m
[32m  # in the right location in the Nix store for kernel modules).[0m
[32m  # We need this when the kernel (or some module) auto-loads a[0m
[32m  # module.[0m
[32m  echo /nix/store/d60481jmwlgh80kxrn4bmfmkpxmv2cip-kmod-31/bin/modprobe > /proc/sys/kernel/modprobe[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "modprobe" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet udevd:[0m
[32m  _localstatus=0[0m
[32m  # The deprecated hotplug uevent helper is not used anymore[0m
[32m  if [ -e /proc/sys/kernel/hotplug ]; then[0m
[32m    echo "" > /proc/sys/kernel/hotplug[0m
[32m  fi[0m
[32m  [0m
[32m  # Allow the kernel to find our firmware.[0m
[32m  if [ -e /sys/module/firmware_class/parameters/path ]; then[0m
[32m    echo -n "/nix/store/d97p4z8x60vfv57krbxsrb0a98hlz17q-firmware/lib/firmware" > /sys/module/firmware_class/parameters/path[0m
[32m  fi[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "udevd" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet usrbinenv:[0m
[32m  _localstatus=0[0m
[32m  mkdir -p /usr/bin[0m
[32m  chmod 0755 /usr/bin[0m
[32m  ln -sfn /nix/store/fr9yr63a1267cr0r86w18c77mh3xavcc-coreutils-9.6/bin/env /usr/bin/.env.tmp[0m
[32m  mv /usr/bin/.env.tmp /usr/bin/env # atomically replace /usr/bin/env[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "usrbinenv" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  #### Activation script snippet var:[0m
[32m  _localstatus=0[0m
[32m  [0m
[32m  [0m
[32m  if (( _localstatus > 0 )); then[0m
[32m    printf "Activation script snippet '%s' failed (%s)\n" "var" "$_localstatus"[0m
[32m  fi[0m
[32m  [0m
[32m  [0m
[32m  # Make this configuration the current configuration.[0m
[32m  # The readlink is there to ensure that when $systemConfig = /system[0m
[32m  # (which is a symlink to the store), /run/current-system is still[0m
[32m  # used as a garbage collection root.[0m
[32m  ln -sfn "$(readlink -f "$systemConfig")" /run/current-system[0m
[32m  [0m
[32m  exit $_status[0m
[32m  [32m'';[0m
[31m-environment.etc.hosts.source = Â«derivation /nix/store/zf5i8fjqbkwbhkcp8hn1y7mzhf4mz3bv-hosts.drvÂ»;[0m
[32m+environment.etc.hosts.source = Â«derivation /nix/store/h1w5w95w4lyva2x9kc38w393hqz72rlw-hosts.drvÂ»;[0m
[31m-environment.etc.hostname.source = Â«derivation /nix/store/g93cblq7gpwb32z60yls48m07dmxgxhq-etc-hostname.drvÂ»;[0m
[32m+environment.etc.hostname.source = Â«derivation /nix/store/93z4bcdinzc444swpp7zfyvar58mbnwq-etc-hostname.drvÂ»;[0m
[31m-environment.etc.hostname.text = ''[0m
[31m  nixos[0m
[31m  [31m'';[0m
[32m+environment.etc.hostname.text = ''[0m
[32m  machine[0m
[32m  [32m'';[0m
[31m-i18n.inputMethod.type = null;[0m
[31m-networking.hostName = "nixos";[0m
[32m+networking.hostName = "machine";[0m
